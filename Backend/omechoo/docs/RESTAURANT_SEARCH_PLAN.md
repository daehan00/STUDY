# 식당 검색 및 상세 정보 (Map & List) 구현 기획안

## 1. 개요 (Overview)
본 문서는 "메뉴 추천" 이후 연결되는 **"식당 찾기"** 기능의 상세 구현 계획입니다.
사용자의 선호와 상황에 맞춰 **지도 모드(Map Mode)**와 **리스트 모드(List Mode)** 두 가지 뷰를 제공하며, 기본 정보 조회 후 사용자의 명시적 요청 시에만 **상세 API**를 호출하여 심층 정보를 제공하는 효율적인 구조를 채택합니다.

---

## 2. 사용자 경험 흐름 (UX Flow)

```mermaid
graph TD
    A[메뉴 추천 결과] -->|식당 찾기 클릭| B{위치 권한 확인}
    
    B -->|동의| C[내 위치 기준 검색]
    B -->|거부| D[위치 설정 모달 (지역 검색)]
    
    C --> E[결과 화면 진입]
    D --> E
    
    E --> F{뷰 모드 선택}
    F -->|Map (Default)| G[지도 핀 표시]
    F -->|List| H[식당 리스트 표시]
    
    G -->|핀 클릭| I[하단 요약 카드 (Summary)]
    I -->|상세보기 클릭| J{상세 API 호출}
    H -->|카드 클릭| J
    
    J --> K[식당 상세 정보 페이지/모달]
```

---

## 3. 상세 화면 설계 (Dual View Mode)

사용자는 상단의 **[지도 | 목록]** 토글 스위치를 통해 언제든 뷰 모드를 전환할 수 있습니다.

### 3-1. 공통 헤더 (Header)
*   **좌측:** 뒤로가기 (메뉴 선택으로 이동)
*   **중앙:** 검색된 메뉴명 (예: "마라탕 맛집")
*   **우측:** 뷰 모드 토글 (Map ↔ List)
*   **하단 바:** 현재 설정된 위치 표시 (예: "현위치: 강남구 역삼동") + [위치 변경] 버튼

### 3-2. 지도 모드 (Map Mode) - *위치 중심 탐색*
*   **기본 UI:** 전체 화면 지도.
*   **마커 (Pins):** 검색된 식당 위치에 핀 표시.
*   **인터랙션:**
    1.  핀 클릭 → **요약 오버레이(Summary Overlay)**가 하단에 뜸.
        *   *표시 정보:* 식당 이름, 평점, 거리, 대표 이미지 1장 (있을 경우).
    2.  오버레이 클릭 → **상세 정보(Full Detail)** 호출.
*   **기능:**
    *   **현위치 버튼:** 우측 하단 FAB. 클릭 시 지도 중심을 내 위치로.
    *   **재검색:** 지도를 움직이면 "이 지역에서 다시 찾기" 버튼 노출.

### 3-3. 리스트 모드 (List Mode) - *정보 중심 탐색*
*   **기본 UI:** 스크롤 가능한 수직 리스트.
*   **카드 아이템:**
    *   좌측: 썸네일 (또는 플레이스홀더).
    *   우측: 식당 이름, 별점, 거리, 주요 메뉴 가격대, 카테고리.
*   **인터랙션:**
    *   카드 클릭 → **상세 정보(Full Detail)** 호출.
*   **Empty State:** 위치가 설정되지 않았거나 결과가 없을 때 "위치를 설정해주세요" 또는 "검색 결과 없음" 표시.

### 3-4. 식당 상세 정보 (Detail View)
*   **진입 시점:** 사용자가 요약 정보나 리스트 아이템을 클릭했을 때.
*   **데이터 로딩:** `GET /api/restaurant/{id}/detail` (크롤링/상세 조회) 호출.
*   **UI 구성 (Bottom Sheet or Full Page):**
    *   **헤더:** 가게 이름, 총 평점, 리뷰 수.
    *   **정보 탭:** 영업 시간(브레이크 타임), 전화번호, 주소 (지도 링크).
    *   **메뉴 탭:** 상세 메뉴 리스트 및 가격.
    *   **리뷰 탭:** 주요 리뷰 키워드 또는 최신 리뷰.

---

## 4. 데이터 연동 전략

### 4-1. 기본 검색 (Search API) - *가볍고 빠르게*
*   **Endpoint:** `POST /api/restaurant/search`
*   **Trigger:** 페이지 진입, 지도 재검색, 위치 변경 시.
*   **Response:** 식당 ID, 이름, 위경도, 거리, 썸네일 URL(옵션), 간단한 카테고리.
*   **목적:** 지도에 핀을 찍고 리스트를 그리기 위한 최소 정보.

### 4-2. 상세 조회 (Detail API) - *On-Demand*
*   **Endpoint:** `POST /api/restaurant/detail`
*   **Request Body:** `{ "url": "http://place.map.kakao.com/..." }`
*   **Trigger:** 사용자가 특정 식당을 **클릭**했을 때만 호출.
*   **Response:** 영업시간, 상세 메뉴판, 블로그/방문자 리뷰 요약 등 Heavy한 정보.
*   **UX:** 로딩 중에는 스켈레톤 UI 표시.

---

## 5. 위치 설정 프로세스 (Location Strategy)

1.  **자동 (Auto):**
    *   페이지 최초 진입 시 `navigator.geolocation` 시도.
    *   성공 시: 해당 좌표로 검색 API 호출.
    *   실패/거부 시: **"위치 설정이 필요해요"** 모달 또는 리스트 모드로 전환 후 지역 선택 유도.

2.  **수동 (Manual):**
    *   [위치 변경] 버튼 클릭.
    *   **주소 검색 모달:** (카카오 우편번호 서비스 또는 키워드 검색) 활용.
    *   선택한 주소의 좌표(Lat/Lng)를 획득하여 검색 API 호출.

---

## 6. 개발 로드맵

### Phase 1: 기반 구축
*   [ ] 카카오맵 SDK 연동 및 지도 컴포넌트 (`KakaoMap`) 구현.
*   [ ] 뷰 모드(Map/List) 상태 관리 및 토글 UI 구현.
*   [ ] Geolocation 훅 구현 및 위치 권한 처리 로직.

### Phase 2: 검색 리스트/마커 구현
*   [ ] `RestaurantList` 컴포넌트 구현 (더미 데이터 활용).
*   [ ] 지도 마커 렌더링 및 클릭 이벤트 핸들링.
*   [ ] `search` API 연동.

### Phase 3: 상세 정보 및 인터랙션
*   [ ] 하단 요약 오버레이 (`SummarySheet`) 구현.
*   [ ] 식당 상세 모달 (`DetailModal`) 구현 및 `detail` API 연동.
*   [ ] 로딩/에러 상태 처리 (스켈레톤 등).

### Phase 4: 위치 설정 고도화
*   [ ] 주소 검색/지역 선택 모달 구현.
*   [ ] "이 지역에서 재검색" 기능 (지도 Drag & Drop 이벤트).
